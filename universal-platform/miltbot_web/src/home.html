<!DOCTYPE HTML>
<html>
  <head>
    <meta charset="utf-8" />
    <link rel="stylesheet" type="text/css" href="../libs/bulma.css">
    <link rel="stylesheet" href="../css/index.css">
    <!--<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.js"></script>-->
    <script type="text/javascript" src="../libs/jquery.js"></script>
    <script type="text/javascript" src="../script/index.js" ></script>

    <script type="text/javascript" src="../libs/eventemitter2.min.js"></script>
    <script type="text/javascript" src="../libs/roslib.min.js"></script>

    <script type="text/javascript">
      var ros = new ROSLIB.Ros({
        url : 'ws://127.0.1.1:9090'
      });
    
      ros.on('connection', function() {
        console.log('Connected to websocket server.');
      });
    
      ros.on('error', function(error) {
        console.log('Error connecting to websocket server: ', error);
      });
    
      ros.on('close', function() {
        console.log('Connection to websocket server closed.');
      });
      
      var building;
      var building_floor;
      var building2;
      var building_floor2;
      var robot_list;

      function showNavigationState(building, building_floor,idx) {
        var x = "";
        x = x + "<p>";
        x = x + "Current Building: " + building + "<br>";
        x = x + "Current Floor: " + building_floor + "<br>";
        x = x + "</p>";
        if(idx == 0) {
          document.getElementById("navigation_state").innerHTML = x;
        }
        else if(idx == 1){
          document.getElementById("navigation_state2").innerHTML = x;
        }
      }

      function showNumOfRobot() {
        var x = "";
        x = x + "<p>";
        x = x + robot_list.length + " ตัว" + "<br>";
        x = x + "</p>";
        document.getElementById("robot_count").innerHTML = x;
      }

      var navigation_state_sub = new ROSLIB.Topic({
        ros : ros,
        name : '/bot1/navigation_state',
        messageType : 'miltbot_navigation/NavigationState',
        throttle_rate: 1000
      });

      navigation_state_sub.subscribe(function(message) {
        building = message.building;
        building_floor = message.building_floor;
        // console.log(target_queue);
        showNavigationState(building, building_floor,0)
        // target_queue_sub.unsubscribe();
      });

      var navigation_state2_sub = new ROSLIB.Topic({
        ros : ros,
        name : '/bot2/navigation_state',
        messageType : 'miltbot_navigation/NavigationState',
        throttle_rate : 1000
      });

      navigation_state2_sub.subscribe(function(message) {
        building2 = message.building;
        building_floor2 = message.building_floor;
        // console.log(target_queue);
        showNavigationState(building2, building_floor2,1)
        // target_queue_sub.unsubscribe();
      });

      var robot_list_sub = new ROSLIB.Topic({
        ros : ros,
        name : '/robot_list',
        messageType : 'miltbot_system/RobotList',
        throttle_rate : 1000
      });

      robot_list_sub.subscribe(function(message) {
        robot_list = message.robot_list;
        showNumOfRobot(robot_list);
      });
    </script>

  </head>

  <body>
    <nav class="nav has-shadow">
      <div class="container" id="nav">
        <a class="nav-item">
          
          <h1 class="title is-2">Miltbot</h1>
        </a>
        <a class="nav-item is-tab is-active" href="home.html">Home</a>
        <a class="nav-item is-tab" href="task/task-manager.html">Task Manager</a>
        <!--<a class="nav-item is-tab" href="monitor.html">System Monitor</a>-->
        <!--<a class="nav-item is-tab" href="map/map-manager.html">Map Manager</a>-->
        <!--<a class="nav-item is-tab" href="about.html">About</a>-->
      </div>
    </nav>

    <section class="section">
      <div class="container">
        <h1 class="title is-3">Overview</h1>
        <hr>
        <div class="columns">
          <div class="column"> 
            <div class="box">
              <h2 class="title is-5">Number of robots in the system</h2>
              <hr>
              <p id="robot_count"></p>
            </div>
          </div>
          <div class="column">
            <div class="box">
              <h2 class="title is-5">Number of floor in the system </h2>
              <hr>
              <p>2 ชั้น</p>
            </div>
          </div>
          <!--<div class="column">
            <div class="box">
              <h2 class="title is-5">Robot1 Status</h2>
              <hr>
              <p>2 งาน</p>
              
            </div>
          </div>-->
        </div>
        <div class="columns">
          <div class="column">
            <div class="box">
              <h2 class="title is-5">Robot1 Status</h2>
              <hr>
              <p id="navigation_state"></p>
            </div>
          </div>
          <!--<div class="column">
            <div class="box">
              <h2 class="title is-5">Robot2 Status</h2>
              <hr>
              <p id="navigation_state2"></p>
              
            </div>
          </div>-->
        </div>
        <!--<div class="box">
              จำนวนชั้นที่มีในระบบ + ขื่อ
        </div>-->
      </div>
    </section>

  </body>
</html>
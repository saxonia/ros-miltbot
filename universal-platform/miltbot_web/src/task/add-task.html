<!DOCTYPE HTML>
<html>
  <head>
    <meta charset="utf-8" />
    <link rel="stylesheet" type="text/css" href="../../libs/bulma.css">
    <link rel="stylesheet" href="../../css/index.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.js"></script>
    <script type="text/javascript" src="../../script/index.js" ></script>

    <script type="text/javascript" src="../../libs/eventemitter2.min.js"></script>
    <script type="text/javascript" src="../../libs/roslib.min.js"></script>

    <script type="text/javascript">
      var ros = new ROSLIB.Ros({
        url : 'ws://127.0.1.1:9090'
      });
    
      ros.on('connection', function() {
        console.log('Connected to websocket server.');
      });
    
      ros.on('error', function(error) {
        console.log('Error connecting to websocket server: ', error);
      });
    
      ros.on('close', function() {
        console.log('Connection to websocket server closed.');
      });

      var waypoints;
      var task_id;
      var robot_id = 0;
      var floor_id = 0;
      var target_id;

      function viewWaypoint(waypoints) {
        var x = "";
        for(var i = 0; i < waypoints.length; i++) {
          if(i == 0) {
            x = x + "<option disabled selected>Select Target</option>";
          }
          else {
            x = x + "<option value=\"" + i-1 + "\">";
            x = x + waypoints[i].name;
            x = x + "</option>";
          }
        }
          document.getElementById("select-target").innerHTML = x;
      }

      var getWaypointListClient = new ROSLIB.Service({
        ros : ros,
        name : '/get_waypoint_list',
        serviceType : 'miltbot_map/GetWaypointList'
      });
      var request = new ROSLIB.ServiceRequest({
        building : "Building 4",
        floor : "Floor 20"
      });
    
      getWaypointListClient.callService(request, function(result) {
        waypoints = result.waypoints;
        viewWaypoint(result.waypoints);
      });

      var addTargetClient = new ROSLIB.Service({
        ros : ros,
        name : '/bot1/add_target',
        serviceType : 'miltbot_system/AddTarget'
      });

      function accept() {
        task_id = document.getElementById("select-task").value;
        target_id = document.getElementById("select-target").value;
        var waypoint = waypoints[target_id];
        var task;
        if(task_id == 0) {
          task = "SINGLERUN";
        }
        else if(task_id == 1) {
          task = "GOING";
        }
        else if(task_id == 2) {
          task = "SENDSUPPLIES";
        }
        else {
          return;
        }
        waypoint.task = task;
        // waypoint.

        var request = new ROSLIB.ServiceRequest({
          waypoint : 
        // });
        // addTargetClient.callService(request, function(result) {
        //   console.log(result.success);
        // });
      }

      function selectChange() {
        var e = document.getElementById("select-task");
        // console.log(e.value);
        // document.getElementById("show").innerHTML = e.value;
      }
    </script>

  </head>

  <body>
    <nav class="nav has-shadow">
      <div class="container" id="nav">
        <a class="nav-item">
          <img src="http://bulma.io/images/bulma-logo.png" alt="Bulma logo">
          <!--<h1>Miltbot</h1>-->
        </a>
        <a class="nav-item is-tab " href="../home.html">Home</a>
        <a class="nav-item is-tab is-active" href="task-manager.html">Task Manager</a>
        <a class="nav-item is-tab" href="monitor.html">System Monitor</a>
        <a class="nav-item is-tab" href="map-manager.html">Map Manager</a>
        <a class="nav-item is-tab" href="about.html">About</a>
      </div>
    </nav>

    <section class="section">
      <div class="container">
        <h1 class="title is-3">Add Task</h1>
        <hr>
        <div class="box">
          <div class="columns">
            <div class="column">
              <label class="label">Task</label>
              <p class="control">
                <span class="select">
                  <select id="select-task" onchange="selectChange()">
                    <option disabled selected>Select Task</option>
                    <option value="0">Go To Target</option>
                    <option value="1">Receive Supplies</option>
                    <option value="2">Send Supplies</option>
                  </select>
                </span>
              </p>
            </div>
            <div class="column"> 
              <label class="label">Robot</label>
              <p class="control">
                <span class="select">
                  <select>
                    <option disabled selected>Select Robot</option>
                    <option value="0">Robot1</option>
                  </select>
                </span>
              </p>
            </div>
            <div class="column">
              <label class="label">Floor</label>
              <p class="control">
                <span class="select">
                  <select>
                    <option disabled selected>Select Floor</option>
                    <option value="0">Floor M</option>
                    <!--<option>Floor 17</option>-->
                    <!--<option>Floor 20</option>-->
                  </select>
                </span>
              </p>
            </div>
            <div class="column">
              <label class="label">Target</label>
              <p class="control">
                <span class="select">
                  <select id="select-target">
                    <!--<option disabled selected>Select Target</option>-->
                  </select>
                </span>
              </p>
            </div>
          </div>
          
          <div class="control is-grouped">
            <p class="control">
              <a class="button is-primary" onclick="accept()" >
                Accept
              </a>
            </p>
            <p class="control">
              <a class="button is-danger" href="task-robot.html">
                Cancel
              </a>
            </p>
          </div>
          <p id="show"></p>
        </div>
      </div>
    </section>
    
  </body>
</html>